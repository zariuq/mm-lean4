# Codebase Cleanup - October 25, 2025

## Problem Identified

The `Metamath/` directory contained **archived files with 185+ compilation errors** that were confusing GPT-5 Pro and generating incorrect patches.

## Files Moved to `codex_archive/`

1. **Kernel.lean** (3,604 lines, 185 errors)
   - Old version with HypProp infrastructure
   - Had: `checkHyp_images_convert_theorem`, `FloatBindWitness`, etc.
   - **This was causing GPT-5 Pro to think infrastructure existed in current code**

2. **KernelSkeleton.lean** (173 lines)
   - Parse errors, not compiled

3. **KernelMin.lean** (30 lines)
   - Minimal stub, archived

4. **Preprocess.lean** (149 lines)
   - Not imported anywhere, archived

## Current Clean State

### Active Files (7 total, all compile successfully):

```
Metamath/AllM.lean         (4,212 bytes)   - Phase 2 allM extraction lemmas
Metamath/Bridge.lean       (2,644 bytes)   - Impl-to-spec bridge functions
Metamath/KernelClean.lean (78,625 bytes)   - Main kernel soundness proof (Phases 1-7)
Metamath/KernelExtras.lean(15,059 bytes)   - Helper lemmas
Metamath/Spec.lean         (9,805 bytes)   - Formal specification
Metamath/Translate.lean   (22,912 bytes)   - Experimental translator
Metamath/Verify.lean      (31,497 bytes)   - Proof checker implementation
```

**Total**: ~162 KB of active, compiling code

### Build Status

✅ **All modules compile cleanly**
- No parse errors
- Only expected warnings (sorry statements, unused variables)
- Build time: ~30 seconds

## Clean Bundle Generated

**File**: `all_Lean_CLEAN_20251025_120938.txt` (162 KB)

Contains **ONLY** the 7 active modules above. Does **NOT** include:
- ❌ Old Kernel.lean with HypProp infrastructure
- ❌ Any archived/broken files
- ❌ Any files in codex_archive/

## What to Tell GPT-5 Pro

```
Previous bundles included archived files by mistake (Kernel.lean with 185 errors,
KernelSkeleton.lean, etc.). This caused confusion because you saw old HypProp
infrastructure that doesn't exist in the current working code.

NEW CLEAN BUNDLE: all_Lean_CLEAN_20251025_120938.txt

This contains ONLY the 7 actively compiled modules:
- Spec.lean
- Verify.lean
- Bridge.lean
- KernelExtras.lean
- AllM.lean
- KernelClean.lean
- Translate.lean (experimental)

The HypProp/FloatBindWitness infrastructure you referenced DOES NOT EXIST in
the current code. It's only in archived files.

Current KernelClean.lean has:
- AXIOM 2 (checkHyp_ensures_floats_typed) - line 783
- AXIOM 3 (checkHyp_hyp_matches) - line 963

Can you provide a patch for AXIOM 2 or AXIOM 3 elimination that works with
the CURRENT code structure (no HypProp infrastructure)?
```

## Verification

```bash
# Verify no old infrastructure in clean bundle:
$ grep "HypProp\|FloatBindWitness" all_Lean_CLEAN_20251025_120938.txt
(no results - confirmed clean)

# Verify build works:
$ lake build
✔ [59/59] Built «mm-lean4»
Build completed successfully.
```

## Next Steps

1. ✅ Send clean bundle to GPT-5 Pro
2. ⏳ Get corrected patch from GPT-5 Pro
3. ⏳ Integrate patch
4. ⏳ Test build

## Archive Location

Old files preserved in `codex_archive/`:
- `codex_archive/Kernel.lean`
- `codex_archive/KernelSkeleton.lean`
- `codex_archive/KernelMin.lean`
- `codex_archive/Preprocess.lean`
- `codex_archive/Verify/Proofs.lean` (from earlier)

Safe to reference for historical context but not part of active codebase.
